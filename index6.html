<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Créateur de Site PRO v3</title>
<link id="google-fonts-link" rel="stylesheet">
<style id="main-styles">
    :root {
        --color-accent: #007bff; --color-heading: #212529; --color-text: #343a40; --color-bg: #ffffff; --color-surface: #f8f9fa;
        --border-color: #dee2e6;
        --font-heading: "Playfair Display", serif; --font-body: "Roboto", sans-serif;
        --shadow-sm: 0 2px 10px rgba(0,0,0,0.07); --shadow-md: 0 5px 20px rgba(0,0,0,0.1);
        --border-radius: 5px;
    }
    html.dark-theme {
        --color-accent: #4dabf7; --color-heading: #ffffff; --color-text: #ced4da; --color-bg: #121212; --color-surface: #1e2022;
        --border-color: #495057;
    }
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { font-family: var(--font-body); background-color: #eef1f3; color: #333; line-height: 1.6; }
    h1, h2, h3, h4, h5, h6 { font-family: var(--font-heading); }
    .container { display: flex; height: 100vh; }
    .customizer { width: 420px; background: #fff; padding: 25px; box-shadow: var(--shadow-md); overflow-y: auto; display: flex; flex-direction: column; z-index: 10; }
    .customizer h2 { margin-bottom: 20px; border-bottom: 2px solid var(--color-accent); padding-bottom: 10px; color: #2c3e50; font-size: 1.5rem; display: flex; align-items: center; gap: 10px; }
    .form-group { margin-bottom: 18px; }
    .form-group label { display: block; margin-bottom: 6px; font-weight: 600; color: #34495e; font-size: 0.9rem; }
    .form-group input, .form-group select, .form-group textarea { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: var(--border-radius); font-family: inherit; transition: border-color 0.3s; background: #fdfdfd; font-size: 1rem; }
    .form-group input:focus, .form-group select:focus, .form-group textarea:focus { border-color: var(--color-accent); outline: none; box-shadow: 0 0 5px rgba(0, 123, 255, 0.25); }
    .tabs { display: flex; flex-wrap: wrap; gap: 5px; margin-bottom: 20px; }
    .tabs button { padding: 12px 5px; cursor: pointer; background: #f9f9f9; border: 1px solid #ddd; font-weight: 600; transition: all 0.3s; border-radius: var(--border-radius); font-size:0.9rem; flex-grow: 1; }
    .tabs button.active { background: var(--color-accent); color: white; border-color: var(--color-accent); }
    .preview { flex: 1; padding: 20px; background-color: #dce3e9; }
    .preview-container { width: 100%; height: 100%; border: 8px solid #333; border-radius: 10px; background: var(--color-bg); color: var(--color-text); box-shadow: 0 10px 30px rgba(0,0,0,0.2); overflow: hidden; }
    .btn { display: inline-block; padding: 12px 25px; background: var(--color-accent); color: #fff; border: none; border-radius: var(--border-radius); cursor: pointer; font-weight: 600; text-align: center; text-decoration: none; transition: all 0.3s; font-size: 1rem; }
    .btn-group { margin-top: auto; padding-top: 20px; border-top: 1px solid #eee; display: flex; flex-wrap: wrap; gap: 10px; }
    .btn-group .btn { flex-grow: 1; font-size: 0.9rem; }
    .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; display: flex; justify-content: center; align-items: center; opacity: 0; visibility: hidden; transition: opacity 0.3s; }
    .modal-overlay.visible { opacity: 1; visibility: visible; }
    .modal-content { background: #fff; padding: 30px; border-radius: 8px; box-shadow: var(--shadow-md); width: 90%; max-width: 500px; position: relative; }
    .modal-close-btn { position: absolute; top: 15px; right: 15px; background: none; border: none; font-size: 1.5rem; cursor: pointer; color: #888; }
    
    /* --- Styles communs pour la prévisualisation --- */
    #websitePreview { height: 100%; overflow-y: auto; font-family: var(--font-body); background: var(--color-bg); color: var(--color-text); scroll-behavior: smooth; }
    #websitePreview h1, #websitePreview h2, #websitePreview h3 { font-family: var(--font-heading); color: var(--color-heading); }
    #websitePreview .page-content { display: none; }
    #websitePreview .page-content.active { display: block; animation: fadeIn 0.5s; }
    @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    #websitePreview .btn { border-radius: var(--border-radius); }
    #websitePreview .card { background: var(--color-bg); padding: 25px; border-radius: var(--border-radius); }
    #websitePreview .card.shadow { box-shadow: var(--shadow-sm); }
    #websitePreview .card.flat { border: 1px solid var(--border-color); }
    #websitePreview .section { padding: clamp(40px, 5vw, 80px) 5%; }
    
    /* === STYLES TEMPLATE: BOULANGERIE === */
    .template-boulangerie header { text-align: center; padding: 20px; background-color: var(--color-surface); border-bottom: 3px solid var(--color-accent); }
    .template-boulangerie h1.logo { font-size: 2.5rem; margin: 0; }
    .template-boulangerie nav { display: flex; justify-content: center; gap: 30px; padding: 15px; background: var(--color-bg); }
    .template-boulangerie .hero { background-size: cover; background-position: center; text-align: center; padding: 100px 20px; color: white; }
    .template-boulangerie .hero h2 { color: white; font-size: 3rem; text-shadow: 2px 2px 4px rgba(0,0,0,0.6); }
    .template-boulangerie .grid-2 { display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 30px; align-items: center; }
    .template-boulangerie .horaires-list { list-style: none; padding: 0; }
    .template-boulangerie .horaires-list li { display: flex; justify-content: space-between; padding: 8px 0; border-bottom: 1px dashed var(--border-color); }
    .template-boulangerie footer { background: var(--color-heading); color: var(--color-surface); text-align: center; padding: 30px; }

    /* === STYLES TEMPLATE: RESTAURANT === */
    .template-gastronomie { background-color: var(--color-bg); }
    .template-gastronomie header { display: flex; justify-content: space-between; align-items: center; padding: 20px 5%; background: rgba(0,0,0,0.6); position: absolute; top: 0; width: 100%; z-index: 10; }
    .template-gastronomie .logo { font-size: 2rem; color: white; }
    .template-gastronomie nav a { color: white; text-decoration: none; margin-left: 25px; }
    .template-gastronomie .hero { background-size: cover; background-position: center; min-height: 80vh; display: flex; flex-direction: column; justify-content: center; align-items: center; color: white; text-align: center; }
    .template-gastronomie .hero h1 { font-size: 4rem; text-shadow: 2px 2px 5px #000; color: white; }
    .template-gastronomie .menu-category h3 { border-bottom: 2px solid var(--color-accent); display: inline-block; margin-bottom: 20px; }
    .template-gastronomie .menu-item { display: grid; grid-template-columns: 1fr auto; gap: 15px; margin-bottom: 15px; }
    .template-gastronomie .menu-item p { margin: 0; }
    .template-gastronomie .menu-item .price { color: var(--color-accent); font-weight: bold; }
    .template-gastronomie footer { text-align: center; background-color: var(--color-surface); padding: 40px; }
    
    /* === STYLES TEMPLATE: ARTISAN (SERVICES) === */
    .template-artisan-services header { background-color: var(--color-bg); padding: 15px 5%; display: flex; justify-content: space-between; align-items: center; border-bottom: 1px solid var(--border-color); }
    .template-artisan-services .logo { font-weight: bold; font-size: 1.5rem; }
    .template-artisan-services .contact-header { font-size: 1.2rem; font-weight: bold; color: var(--color-accent); }
    .template-artisan-services .hero { background-color: var(--color-accent); color: white; text-align: center; padding: 80px 20px; }
    .template-artisan-services .hero h1 { color: white; }
    .template-artisan-services .services-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; }
    .template-artisan-services .service-card { text-align: center; }
    .template-artisan-services .service-card i { font-size: 2.5rem; color: var(--color-accent); margin-bottom: 15px; }
    .template-artisan-services .cta-section { background-color: var(--color-surface); text-align: center; }
    .template-artisan-services footer { background: var(--color-heading); color: white; text-align: center; padding: 30px; }
</style>
</head>
<body>
<div class="container">
    <div class="customizer">
        <h2><i class="fas fa-tachometer-alt"></i> Dashboard</h2>
        <div class="tabs">
            <button class="tab-btn active" data-page="general">Général</button>
            <button class="tab-btn" data-page="contenu">Contenu</button>
            <button class="tab-btn" data-page="section2">Section 2</button>
            <button class="tab-btn" data-page="contact">Contact</button>
        </div>
        <div id="tabContent"></div>
        <div class="btn-group">
            <button class="btn btn-secondary" id="importJsonBtn" title="Importer"><i class="fas fa-upload"></i></button>
            <button class="btn btn-secondary" id="exportJsonBtn" title="Exporter"><i class="fas fa-file-code"></i></button>
            <button class="btn" id="requestFeatureBtn" title="Demander un ajout"><i class="fas fa-lightbulb"></i></button>
            <button class="btn" id="downloadBtn" title="Télécharger le site HTML"><i class="fas fa-download"></i> Télécharger</button>
            <input type="file" id="importFileInput" accept="application/json" style="display: none;">
        </div>
    </div>
    <div class="preview">
        <div class="preview-container" id="websitePreview"></div>
    </div>
</div>

<div class="modal-overlay" id="featureRequestModal">
    <div class="modal-content">
        <button class="modal-close-btn" id="modalCloseBtn">&times;</button>
        <h3>Demander un ajout</h3>
        <p style="font-size:0.9rem; margin-bottom:15px; color: #555;">Votre configuration sera jointe à la demande.</p>
        <form id="featureRequestForm" action="https://formsubmit.co/school.dlecointre@gmail.com" method="POST">
            <input type="hidden" name="_subject" value="Nouvelle demande d'ajout !">
            <input type="hidden" name="_next" value="https://use-go-to.github.io/website/index6.html">
            <input type="hidden" name="_captcha" value="false">
            <div class="form-group">
                <input type="text" name="nom_demande" placeholder="Nom du module/modification" required>
            </div>
            <div class="form-group">
                <textarea name="details_demande" placeholder="Détails de votre demande..." required></textarea>
            </div>
            <input type="hidden" name="configuration_json" id="jsonConfigInput">
            <button type="submit" class="btn">Envoyer</button>
        </form>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js"></script>
<script>
document.addEventListener('DOMContentLoaded', () => {

    // --- 1. STATE & TEMPLATES ---

    let websiteData = {
        general: {
            templateId: 'boulangerie',
            siteTitle: "Le Fournil Doré",
            theme: "light",
            fontPair: 'playfair-roboto', // NOUVEAU: Paire de polices
            cardStyle: 'shadow', // NOUVEAU: Style des cartes
            buttonStyle: 'rounded', // NOUVEAU: Style des boutons
            colorAccent: '#c58a47', colorHeading: '#4a2c2a', colorText: '#6b4f4b', colorBg: '#fdfaf5', colorSurface: '#ffffff',
        },
        contact: {
            address: '12 Rue du Pain, 75001 Paris', phone: '01 23 45 67 89', email: 'contact@fournil.fr',
            footerText: `© ${new Date().getFullYear()} Le Fournil Doré.`,
        },
        // Sections spécifiques aux templates
        hero: {
            title: "L'Art du Pain, depuis 1982",
            subtitle: "Chaque jour, nous pétrissons notre passion pour vous offrir le meilleur.",
            image: 'https://images.unsplash.com/photo-1598373182133-52452f7691ef?q=80&w=2070&auto=format&fit=crop',
            ctaText: 'Voir nos créations',
        },
        about: {
            title: "Notre Histoire",
            text: "Fondée par amour du bon pain, notre boulangerie familiale perpétue un savoir-faire artisanal. Nos ingrédients sont locaux et de première qualité.",
            image: 'https://images.unsplash.com/photo-1568254625121-7c8a6c83443a?q=80&w=1974&auto=format&fit=crop',
        },
        horaires: {
            title: "Nos Horaires",
            list: [
                { day: 'Lundi', hours: 'Fermé' },
                { day: 'Mardi - Vendredi', hours: '07:00 - 19:30' },
                { day: 'Samedi', hours: '08:00 - 18:00' },
                { day: 'Dimanche', hours: '08:00 - 13:00' },
            ]
        },
        menu: {
            title: "Notre Menu",
            categories: [
                { name: "Entrées", items: [{ name: "Salade César", desc: "Poulet grillé, parmesan, croûtons", price: "12€" }] },
                { name: "Plats", items: [{ name: "Filet de Boeuf", desc: "Sauce au poivre, frites maison", price: "25€" }] }
            ]
        },
        services: {
            title: "Nos Services",
            items: [
                { icon: "fa-wrench", name: "Dépannage Urgent", desc: "Intervention rapide 7j/7" },
                { icon: "fa-shower", name: "Installation Sanitaire", desc: "Pose de douches, WC, lavabos" },
                { icon: "fa-faucet", name: "Réparation de Fuites", desc: "Recherche et réparation efficace" }
            ]
        }
    };

    // NOUVEAU: Dictionnaire de polices Google Fonts
    const fontPairs = {
        'playfair-roboto': { name: "Élégant (Playfair/Roboto)", heading: "'Playfair Display', serif", body: "'Roboto', sans-serif", url: "https://fonts.googleapis.com/css2?family=Playfair+Display:wght@700&family=Roboto:wght@400&display=swap" },
        'lato-merriweather': { name: "Moderne (Lato/Merriweather)", heading: "'Lato', sans-serif", body: "'Merriweather', serif", url: "https://fonts.googleapis.com/css2?family=Lato:wght@700&family=Merriweather:wght@400&display=swap" },
        'montserrat-opensans': { name: "Pro (Montserrat/Open Sans)", heading: "'Montserrat', sans-serif", body: "'Open Sans', sans-serif", url: "https://fonts.googleapis.com/css2?family=Montserrat:wght@700&family=Open+Sans:wght@400&display=swap" },
    };
    
    // NOUVEAU: Système de Templates par métier
    const templates = {
        'boulangerie': {
            name: 'Boulangerie / Pâtisserie',
            defaults: {
                colorAccent: '#c58a47', colorHeading: '#4a2c2a', colorText: '#6b4f4b', colorBg: '#fdfaf5', colorSurface: '#ffffff',
                fontPair: 'playfair-roboto'
            },
            render: (data) => `
                <div class="template-boulangerie">
                    <header>
                        <h1 class="logo">${data.general.siteTitle}</h1>
                        <p>${data.hero.subtitle.split('.')[0]}</p>
                    </header>
                    <nav>
                        <a href="#about">Notre histoire</a>
                        <a href="#horaires">Horaires</a>
                        <a href="#contact">Contact</a>
                    </nav>
                    <main>
                        <section class="hero" style="background-image: linear-gradient(rgba(0,0,0,0.4), rgba(0,0,0,0.4)), url('${data.hero.image}');">
                            <h2>${data.hero.title}</h2>
                        </section>
                        <section id="about" class="section grid-2">
                            <div>
                                <h2>${data.about.title}</h2>
                                <p>${data.about.text}</p>
                            </div>
                            <img src="${data.about.image}" alt="Intérieur de la boulangerie" style="width:100%; border-radius: var(--border-radius);">
                        </section>
                        <section id="horaires" class="section" style="background-color: var(--color-surface);">
                             <div style="max-width: 600px; margin: auto;">
                                <h2>${data.horaires.title}</h2>
                                <ul class="horaires-list">
                                    ${data.horaires.list.map(h => `<li><span>${h.day}</span> <strong>${h.hours}</strong></li>`).join('')}
                                </ul>
                             </div>
                        </section>
                    </main>
                    <footer id="contact">
                        <p>${data.contact.address} - ${data.contact.phone}</p>
                        <p>${data.contact.footerText}</p>
                    </footer>
                </div>`
        },
        'gastronomie': {
            name: 'Restaurant (Gastronomie)',
            defaults: {
                colorAccent: '#e4a721', colorHeading: '#252525', colorText: '#333333', colorBg: '#ffffff', colorSurface: '#f9f9f9',
                fontPair: 'lato-merriweather'
            },
            render: (data) => `
                <div class="template-gastronomie">
                    <header>
                        <div class="logo">${data.general.siteTitle}</div>
                        <nav><a href="#menu">Menu</a><a href="#contact">Contact</a></nav>
                    </header>
                    <main>
                        <section class="hero" style="background-image: linear-gradient(rgba(0,0,0,0.5), rgba(0,0,0,0.5)), url('${data.hero.image}');">
                            <h1>${data.hero.title}</h1>
                            <p>${data.hero.subtitle}</p>
                            <a href="#" class="btn" style="margin-top: 20px;">Réserver une table</a>
                        </section>
                        <section id="menu" class="section">
                            <h2 style="text-align:center">${data.menu.title}</h2>
                             ${data.menu.categories.map(cat => `
                                <div class="menu-category" style="margin-top:40px;">
                                    <h3>${cat.name}</h3>
                                    ${cat.items.map(item => `
                                        <div class="menu-item">
                                            <div>
                                                <strong>${item.name}</strong>
                                                <p style="font-style: italic; color: var(--color-text);">${item.desc}</p>
                                            </div>
                                            <div class="price">${item.price}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            `).join('')}
                        </section>
                    </main>
                    <footer id="contact">
                        <p>${data.contact.address} | ${data.contact.phone} | <a href="mailto:${data.contact.email}">${data.contact.email}</a></p>
                        <p>${data.contact.footerText}</p>
                    </footer>
                </div>`
        },
        'artisan-services': {
            name: 'Artisan (Services)',
            defaults: {
                colorAccent: '#007bff', colorHeading: '#212529', colorText: '#495057', colorBg: '#ffffff', colorSurface: '#f8f9fa',
                fontPair: 'montserrat-opensans'
            },
            render: (data) => `
                <div class="template-artisan-services">
                    <header>
                        <div class="logo">${data.general.siteTitle}</div>
                        <div class="contact-header"><i class="fas fa-phone"></i> ${data.contact.phone}</div>
                    </header>
                    <main>
                        <section class="hero">
                            <h1>${data.hero.title}</h1>
                            <p>${data.hero.subtitle}</p>
                        </section>
                        <section id="services" class="section">
                            <h2 style="text-align:center;">${data.services.title}</h2>
                            <div class="services-grid">
                                ${data.services.items.map(s => `
                                    <div class="card ${data.general.cardStyle}">
                                        <i class="fas ${s.icon}"></i>
                                        <h3>${s.name}</h3>
                                        <p>${s.desc}</p>
                                    </div>
                                `).join('')}
                            </div>
                        </section>
                         <section class="cta-section section">
                            <h2>Un projet ? Une urgence ?</h2>
                            <p>Contactez-nous dès maintenant pour un devis gratuit et une intervention rapide.</p>
                            <a href="tel:${data.contact.phone}" class="btn" style="margin-top: 20px;">Appeler le ${data.contact.phone}</a>
                         </section>
                    </main>
                    <footer id="contact">
                        <p>${data.contact.address}</p>
                        <p>${data.contact.footerText}</p>
                    </footer>
                </div>`
        },
    };

    // --- 2. DOM Elements & Initial State ---
    const DOM = {
        tabs: document.querySelectorAll('.tab-btn'), tabContent: document.getElementById('tabContent'), preview: document.getElementById('websitePreview'),
        downloadBtn: document.getElementById('downloadBtn'), exportJsonBtn: document.getElementById('exportJsonBtn'),
        importJsonBtn: document.getElementById('importJsonBtn'), importFileInput: document.getElementById('importFileInput'),
        requestFeatureBtn: document.getElementById('requestFeatureBtn'),
        modal: document.getElementById('featureRequestModal'), modalCloseBtn: document.getElementById('modalCloseBtn'),
        featureRequestForm: document.getElementById('featureRequestForm'), jsonConfigInput: document.getElementById('jsonConfigInput'),
        googleFontsLink: document.getElementById('google-fonts-link'),
    };
    
    // --- 3. CORE FUNCTIONS ---

    const updateState = (path, value) => {
        path.split('.').reduce((acc, key, i, arr) => {
            if (i === arr.length - 1) acc[key] = value;
            return acc[key] || {};
        }, websiteData);
        
        if (path.startsWith('general.color') || path === 'general.theme' || path.startsWith('general.font') || path.startsWith('general.button')) applyTheme();
        renderPreview();
    };
    
    const applyTemplate = (templateId) => {
        const template = templates[templateId];
        if (!template) return;
        
        websiteData.general.templateId = templateId;
        Object.assign(websiteData.general, template.defaults);
        
        applyTheme();
        renderPreview();
        renderCustomizerForm();
    };

    const switchTab = (tabName) => {
        DOM.tabs.forEach(btn => btn.classList.toggle('active', btn.dataset.page === tabName));
        renderCustomizerForm(tabName);
    };
    
    const createFormGroup = (path, label, type = 'text', options = {}) => {
        const value = path.split('.').reduce((acc, key) => acc && acc[key], websiteData) ?? '';
        // Function implementation... (same as before)
        const group = document.createElement('div');
        group.className = 'form-group';
        group.innerHTML = `<label for="${path}">${label}</label>`;
        let inputEl;
        if (type === 'select') {
            inputEl = document.createElement('select');
            inputEl.innerHTML = options.choices.map(opt => `<option value="${opt.value}" ${value === opt.value ? 'selected' : ''}>${opt.text}</option>`).join('');
        } else {
             inputEl = document.createElement(type === 'textarea' ? 'textarea' : 'input');
             if(type !== 'textarea') inputEl.type = type;
             inputEl.value = value;
        }
        inputEl.id = path;
        group.appendChild(inputEl);
        group.addEventListener('input', e => {
            if (e.target.id === path) updateState(path, e.target.value);
        });
        return group;
    };

    const renderCustomizerForm = (page = 'general') => {
        DOM.tabContent.innerHTML = '';
        const fragment = document.createDocumentFragment();
        const addField = (path, label, type, options) => fragment.appendChild(createFormGroup(path, label, type, options));
        
        // Dynamic tabs based on template
        const templateId = websiteData.general.templateId;
        const tabsConfig = {
            'boulangerie': { general: 'Général', contenu: 'Contenu', horaires: 'Horaires', contact: 'Contact' },
            'gastronomie': { general: 'Général', contenu: 'Contenu', menu: 'Menu', contact: 'Contact' },
            'artisan-services': { general: 'Général', contenu: 'Contenu', services: 'Services', contact: 'Contact' }
        };
        const currentTabs = tabsConfig[templateId] || { general: 'Général', contenu: 'Contenu', contact: 'Contact' };
        DOM.tabs.forEach(tab => {
            const pageKey = tab.dataset.page;
            if (currentTabs[pageKey]) {
                tab.style.display = 'block';
                tab.textContent = currentTabs[pageKey];
            } else {
                tab.style.display = 'none';
            }
        });
        if (!currentTabs[page]) {
             page = 'general';
             DOM.tabs[0].classList.add('active');
        }

        switch (page) {
            case 'general':
                const templateChoices = Object.keys(templates).map(id => ({ value: id, text: templates[id].name }));
                addField('general.templateId', 'Template du Site', 'select', { choices: templateChoices });
                fragment.querySelector('#general\\.templateId').addEventListener('change', (e) => applyTemplate(e.target.value));
                
                const fontChoices = Object.keys(fontPairs).map(id => ({ value: id, text: fontPairs[id].name }));
                addField('general.fontPair', 'Polices (Titre/Texte)', 'select', { choices: fontChoices });

                addField('general.siteTitle', 'Titre du site');
                addField('general.colorAccent', 'Couleur d\'accentuation', 'color');
                // ... More color fields if needed
                break;
            case 'contenu':
                 addField('hero.title', 'Titre principal (Héro)');
                 addField('hero.subtitle', 'Sous-titre (Héro)', 'textarea');
                 addField('hero.image', 'Image de fond (Héro)');
                 addField('about.title', 'Titre section "A propos"');
                 addField('about.text', 'Texte section "A propos"', 'textarea');
                 addField('about.image', 'Image section "A propos"');
                break;
            case 'horaires':
                addField('horaires.title', 'Titre de la section Horaires');
                // Could add dynamic fields for each day here
                break;
            case 'menu':
                addField('menu.title', 'Titre de la section Menu');
                // Dynamic fields for menu
                break;
            case 'services':
                addField('services.title', 'Titre de la section Services');
                // Dynamic fields for services
                break;
            case 'contact':
                addField('contact.address', 'Adresse'); addField('contact.phone', 'Téléphone'); addField('contact.email', 'Email');
                addField('contact.footerText', 'Texte du pied de page');
                break;
        }
        DOM.tabContent.appendChild(fragment);
    };
    
    const renderPreview = () => {
        const templateId = websiteData.general.templateId;
        const activeTemplate = templates[templateId] || templates['boulangerie'];
        DOM.preview.innerHTML = activeTemplate.render(websiteData);
    };
    
    const applyTheme = () => {
        const { theme, fontPair, buttonStyle, ...colors } = websiteData.general;
        const root = document.documentElement;
        root.className = theme === 'dark' ? 'dark-theme' : '';
        
        // Apply fonts
        const selectedFont = fontPairs[fontPair] || fontPairs['playfair-roboto'];
        DOM.googleFontsLink.href = selectedFont.url;
        root.style.setProperty('--font-heading', selectedFont.heading);
        root.style.setProperty('--font-body', selectedFont.body);

        // Apply colors
        Object.entries(colors).forEach(([key, value]) => {
            if (key.startsWith('color')) {
                const cssVar = `--${key.replace(/([A-Z])/g, '-$1').toLowerCase()}`;
                root.style.setProperty(cssVar, value);
            }
        });

        // Apply styles
        root.style.setProperty('--border-radius', buttonStyle === 'sharp' ? '0px' : '5px');
    };

    const downloadWebsite = () => {
        const { siteTitle, theme, fontPair, ...colors } = websiteData.general;
        const finalHtmlContent = DOM.preview.innerHTML;
        const finalCss = document.querySelector('#main-styles').textContent;
        const selectedFont = fontPairs[fontPair];
        const fontLink = `<link rel="stylesheet" href="${selectedFont.url}">`;
        
        const fullHtml = `<!DOCTYPE html>
<html lang="fr" class="${theme === 'dark' ? 'dark-theme' : ''}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>${siteTitle}</title>
    ${fontLink}
    <style>${finalCss}</style>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/js/all.min.js" defer><\/script>
</head>
<body style="--font-heading:${selectedFont.heading}; --font-body:${selectedFont.body};">
    ${finalHtmlContent}
</body></html>`;
        const blob = new Blob([fullHtml.trim()], { type: 'text/html' });
        const a = document.createElement('a'); a.href = URL.createObjectURL(blob); a.download = 'index.html';
        document.body.appendChild(a); a.click(); document.body.removeChild(a);
    };

    // --- 4. INITIALIZATION & EVENT LISTENERS ---
    
    DOM.tabs.forEach(btn => btn.addEventListener('click', () => switchTab(btn.dataset.page)));
    DOM.downloadBtn.addEventListener('click', downloadWebsite);
    // ... Other listeners for import/export, modal...
     DOM.exportJsonBtn.addEventListener('click', () => { /* export logic */ });
    DOM.importJsonBtn.addEventListener('click', () => DOM.importFileInput.click());
    DOM.importFileInput.addEventListener('change', (e) => { /* import logic */ });
    DOM.requestFeatureBtn.addEventListener('click', () => DOM.modal.classList.add('visible'));
    DOM.modalCloseBtn.addEventListener('click', () => DOM.modal.classList.remove('visible'));
    DOM.featureRequestForm.addEventListener('submit', () => {
        DOM.jsonConfigInput.value = JSON.stringify(websiteData, null, 2);
    });
    
    // Initial Load
    applyTemplate(websiteData.general.templateId);

});
</script>
</body>
</html>
